use std::collections::HashSet;

const INPUT: &[u8] = b"QtGHnGlcwQGvHwMHGnnGfRFCJnRBfVVJRVBfCFBh
qsDjzNWhmspNNqVrfjVfjJCbBVfB
DLhPTmNDTzTqzpmzLpswGMHtMgwglcPQMQvSGM
ctwDjvgtltgglHrSHCsQWBBDfS
ZJZdVnmhmfCprnBTfS
dNddhhdPRRdbdNcvwCPCgCctjPlF
MNNDGMWrQsfhtrTnrm
jcvRPRPJdvccRNFNCjLdcwJCSHtHPmzhsSzPHmfhnftnTffH
RddRcjRvZgZNWNgQQb
fPrvhqhRPSfCCfhrqtbtLcmZmtHCtpCFcc
WFQJlTdzgGJVQGWQTzdJcHbQZtLtHmbbZMZHsZQm
JFNlzTBNJGlNPSRhfqRRrN
tdVVgttdDtJJsNPmzdQmjcPP
CBTMmmmbTBHqHMwQcZPWWsWnzbbnzW
CGlLFCTMGvqBGvGvGSRSRfmtRRtgVgrSLS
LHSGJLWZLqHQHpRHRz
bpBPVtpCwPgBCtqqvzfzMQvjbbjz
lhVsTgPlBNThpBNwBtVThPnrGGWJZnLZFnFrGWsFrWZr
nQbbbjpnsdsGCSlmHtJmvljHMjWt
cDcgThLVcPTHVlVlHllvWp
cwpgghTcRRczDhnQGGCSdfszdSbS
vTMFDNTlDhjTDNMNJDwmWWWfGPfLnnzLGfMmmL
bVQgbpqqtctzLflltnCz
VSqlVSHRFvNwJSDj
RfZfjljffssWLWPTGPjhzT
FDCvMDMJJpBJpBFJCMBDMtPbWbLVPGztWPVTtPmLWGhQ
DpgHggpwBJwzJMrFFvrCrHsffnRScNsdclSnnRnSNs
wTvfHSvSwssPGCLCPhgSCn
QNpMRqRJQMZlBBbRRRMfbZlBhPChghhlChGCtnthctjPhchh
rrrNBbMZqRbqDsFHTwfWTFFwrF
fVgfQhhgfTLHSLNZZHfZ
CDtsqrqlDtqDddsqjsstHrSlNLWLcSZScFWWcNBFcBcc
jrCJrHjDCMMDsJjJMstThppgwvGzVGQzhJvvng
DGlTlSzbSnzmwbmblTBBPgffpNjFHppZBH
WqQdWqqJdCrtvQtJLQjtdcBNfPsNZfHZZsHNNZHsBBHL
cCJcjdRvqrQhqvWMzlbDGVGbSMSnbR
BfQmpfpmsRCRPDSZVSjjSg
MhNJGMTMHGGTbnGMJrbJHTzzdPgSwSqqPjPdZddSqNSwPZDw
TWbWbhnHWBFBFBDD
FrlJbTcBTcrlTlqwZTwWdhWLChLtVhdfLhmwWC
pppSpzBGMMMjSSMSzMNzHRSDVWGWDWVCDtGdtdhLhftthd
RNNgpMPRNgzggFJcBPqFZJZrbc
SdvnnvvntnbDDqtz
wRpFRRspZhgZgFggFMgtczcGGDzQcGlGDMqcDG
CLLCFNZhsppRvvttBPCjStdT
JJDMhSwmMwBnnJPJmQcFtfQtfgQhQQfcgH
ZvCvTGqGVWTZZWptQggGtHfDgcpz
dsVCvDTZWWbZqqCZqVsqsqmNlPNnSJmbNNmlmMSnJLBl
MGnMBMBJFpBcNpdwRWRvRNdblmwW
LSgtPCChgjCPgSSzCSqWLLbrdWlmwmwmFvml
QhHPVSHghCtQFgCzgQhVnDGMGffnpcZMcMfJDf
QwrJqMLRLtBQRtWLJLvQLMrMgNNzPDngNHlHnbbbggHlgZNt
GdfThGcmShTGSfppmFfTHDNNblSZDbbzlBzZZHHg
TffmGBBFcCFFmTGFhBwjJQJMQWqWQCrrvQMR
mRbrjZzRLchHqqdLDllh
mCGCsJSggCmgSGShlhhDVVVwhqSltV
PsfsGNGJvGPfspvcmrTRBrjTZzvT
NRNqFFtqqFrDDQRcJJJNrWDswHwWwbDVTgTwLbVlVD
ZpdHHGPmgwTwldbw
HnnnMPMzChPmnpnmfFJCRqcJqJRRrrtSBc
LnNNLBmTNBNTwNZZjZmRMHJwMHvbWrvPMMWdcP
GtSFDFpzsGVvMJdJsrMbvr
SqQQGGtqqSVtDpGtplVDpVJClmnhnTZNjNfmnmBChCZL
CHltTDsjHNHHdpDRmqdPQpzd
fMMbbZwLJgMVVFmcRqRpzdqbRm
MJJWfnVhMzTNGlNTsh
WtWbtWvrrQGrbcSWHHfSHfgdWJ
zpnPhLPhPnTMMnzMzpMnDzLPjTVjccSgdmjdvSJdHSgdjScj
qqvMMCnDCCCzqqCzhPlLsRsGtrsNlRbZtBRtbrrQ
mPTmlGQnjNTPQQNljnlQnmmCtgRPhghqgqgzqLRPtMqqMzhq
pDsVSZcdVspbdBpcBHBcHhqLWzMbfhMMrMgMgzLRft
pFZpJJFSBFRllvlFNC
pbMVjJbwbbLqlZlstRhjstsN
FSTnfCBcnBSBvSmmCFCCRQhZBZNsRGlsQQNsqZlG
dvcdfFcqmfcmdMdJgwJJHMbH
QSRlWDhQQqDqlTCjTRCSljSmVsPmmGmzsgvppzPVVzdPSP
HHwtMNMZvfPGbdwdggwG
ZFcNMFFvHLMjlCWrqhqchh
jccDSGVVlRLVSVVScWZZwLvbphgwdpLwZv
BQHBtfQQHBfmMtmFznrHzmDwghWphvZZFpDhZvgvpZhh
DmQrPQnBtTnzrrfHrtfMrmTCGqPNjSPCRRGjRCRRqCNjVN
bRDbbtVgPFFbDfgVCtPcGsNNsHccqcGGWCNNzW
ZwlmJwwRSmlJdQRhqGNTqzGTwzqGhc
ZQdZjpljldrSMjmjdRLdmdbVvvtDVFFffvBFPVBgMnBg
rzwGrwPGppqzPMzrdqsssSsvgtQgTTTJsH
LCNNHLmHWvCJstsJss
cfVLLNBmZBVMVDHGwrhM
FCGFrJltMGdFdGtlFtCgFzQfQnZfVVVMDcQDVzVjfD
PSPSPZPRbPRsbBRbHBTPvfVzQcDQqWWnDjnnHDjzcz
RmSTPwSTRpvSlZglgZprZtNp
njtLGLbcNTbbLnLmNTtqnFzVPwJFFzPVFPwMVmfMmV
srpZlSpsSVqgSPJJ
HZsHsrZhrBQpqQvpdprnTnnHTbGLbHnjHGbjbT
vFFnJjvnVSjgCqSCDZ
lswrrcsQrHTHwdrDdhmqqsRhzmggghgsGC
QPrWQWcDNDHdddNrQPfDMLMLtvvMbnBpPFvpFFvL
LgltlRMtcccgMdlzqTVwwrdsqm
FpvfSDNzSpnvGSnNpmsmVqVVrHwvTqVmmw
pGjDFFDpffnWQbnzjLJhhLchPPJMPBLt
lJqBqPvtvVPnttnJjJBjVMzMrFhdQrQFbGbQnrbzGG
msRgTgmTLLmsTDRfQRllMdGzdRbMHQFF
msfDWglWTpSLCgTpSCDsfPjvjtwVjJZqqSSvPVZSqB
VZZWGZGlZZZMZrGMlQBQGWltFzqvzzcVcgzvmgzddccgvqFc
rLjNrDRLDRLTqdCqFCNzFgqg
TJSSbHfDDfSnbpHpJnGhWPtrZWnPhBwWPWBt
ssvsDDjNwhjNhGGgDDRZllltLCLvCWbMffLCfWzb
qVRmJFSQqqVcqSMWMWLMlllbtbVM
PqQBPcFJFcmdrJPJrFrQpsNjnTGgwTwGssRNRnRBsG
sHsJJfSsrpBLHCLJmdqgdZgRNZQlgRNC
VtnFbhFhwjwVPPjhbccQDQqgRlWDQmdWZZDd
hFhFvbhGwzvFbtbPnttGbtjsLBfspSrMvJLrpJTrMsLZrH
nzJDJvvZznnqnZrpTgTpzzTNjlmtsglBjjttQQCgCCtlBj
SRLRfdVfSVcfHdVVdSLdMHQjPtClsmcwNQltjwjCQQwm
RShVLWWfWWGvsTZz
vcdptvndNzrndjctrvcnvtTdbwwRTgwbHDFDTWgqWlWqwqbl
ffVBmQPhshhfPmSfBPfChmmCWFWbDWFbWwwqRDbsgwWMbWFb
SJJCBLZBhfvnJnpGtvRc
HLMMHHpNqWHqFqppPWnshtsLhBnVDtthLLms
JgmSRgCRGbgwGSbgJJjRRDntztrVhnsDrllllwhhzt
bRRCCjgRvJQQdcdjjvRcQdgbZPZpqfqpHHMfNFqNTPWqQWmq
PPwQTlFrLqrLQrPfPJrHtcjtSvdCNNctLCjNdc
DGZMhmVRMGqVmVDnGMbBZhsjHNvjdstddjdjccSBSjds
mqzVnWDmmGzRhqRbbWQQFwPQQTlzPFpTlPJJ
RMmnMrZMlQQpGrQt
gPPgcDBcjdgjBCBcQtNDNzzthltGphhz
FSvPSSjFWFScSWdjWvbTwWJQZQVRsMTQVwTmVR
PwlbMTDQDvMwttThPthhvhvvZzNLzNZjQCNNLWLCRZWQRzNW
VpJHFpgfqdFqqHFGHVSdGmZZRnSsnLjNZCWmmszLSz
drrJRGJVrcMBDwhDbcMh
hghHTgbwHbDqHrgbbbSLzzFNnsVqNVBnLnfs
jMlcMRRmGcRlZQMMJRJSPPmCFzBBzpfBfLfpFLszLNNFVCfz
JlmGlZmvRMgvrgbrrSTw
ZtTTHpprHtQtHtpqPmjVSScjVSjjSNqw
nRvGWhRbnRGzvWCBGPjNdwcSwcnlJdmmSj
vCbsmbWfRsRWWzsMWBQFFrDZpgpFHLgQLMgQ
QlJBfZssjgZsQsDNbScdDZdNcvvF
zrGrVVpVMWMwMVLMwqVWpRdNFSDcFNDFbSddqHldDdqd
VLVtrWpMRCRLWGWMRwVGCVPfCPJnBTQsJlmjsfsPBQjC
GQqpnnFWFcnWpBMhhSZRhQCCCfRQRD
HsbcczlrjzflffLVfDlt
jssvwsHPsjzWdMcgBnvqMB
JMJdMptTbbtpJZhtTMZwJdNWQBPNBlwNBNQWHBCHHPlg
rVqsvVmjrcCqCPsPNQgnsnQglW
rVvzfqvLjFVDVcLjCqLmJFGbpJpRJTGMtbRpdGRG
LrmwdZHlSlcVlSrrDWCzbtpjpgzjtD
gBGgPTTBqPQTqnnPJhMTTCzzppnCvptpnCtzNpDntz
qQPTTPshRRQqcgsflHZcsSLV
smvdTvlPzslmVjMhJlbjrblJ
cqFffFffcwFfpcDSjcnZwZWrQVDrQBhNbrrNBbWVbNhr
nSpRZRjpcHqpCpqnqFRGmvPLtLGmCdCsGLLdtC
PJPLPPHDdPvdnbctfcpt
NRrGNjNzLjltppvpRSRS
LzVWLjTWGLQqBgZWJWBBFg
znzccGnswWrWNCpvvdTCzddC
RfZlRDDDZflSBMhhhPSMMZpmpHHGNCGTmCJTmvmCvJGR
GbBMhhbSMhMffDMZPggSGfhVWLwjsLttWtrjWscVLWnQWswn
jwRzdZZhwhwHSQqpStJHhp
GVGPBvNPvffpvtvp
nsGGDVtFNGgGWjWlTwrwTmjwTR
MQtmmMMmnHGGTmhw
llqvqvvpqdvvrSfrpSfdfnhFSTMNDHFMNFFSGFwMHT
JqvvRgpCfrzCpqqzdfRpRllWZZBQJbVVtMttsVWJbjPbcc
zgqBczqBbBGjdHVgdDFd
lNVhNNnLtZZZGWjdWrSW
PCQhNflCtCwtJwhClMmVcRmpbPqTcmBqpm
wWbqbTwVrQLqlMtrZtZffNfMfP
vhjqqRpRvZsfssZN
ccBjJBqGpRhDGbJldHlgLwddLd
hVScjtgcchVhSgZJSchVwLbNLWnLNwwnwrbWNLgr
BzMdBqzBQzZQPpfrsrbrNdNLsrRR
zPMzmmGpmzGlFQPPmlZPzSVTSVJJcSlcDhTlvSCtjJ
hzdwlqngZQvDfmzF
vcRrcsVNpVQsFfBfPPQB
HCHVWVcCpNMHWRjLwhvhggdjvggM
LBHCTPzHHBcClwppwjjNNl
JddZMRmmssVmvDvJddSJWVWBwpQvwfpwvwwfrrFNQfwjpl
BsVMVZDVZssZhMhJqLzhzzHzPTPnLGqb
bcnNQnBTvvvWTQTJhdHJzhSjpJJjStjd
mMwqwVMMRwhBtjdSVBVl
GfsrwCRmZBcZTvBf
bBjQmmmqWdLqvLbWLtNJccNZZgCBCZgCTg
phfpfzpHPDwfMwvVzlhlJJlggcZgZcRFFlCgZg
zfhpMMDpVVzzhHhzzMMwfnMfSmQmbQvvWqWjmLSqdQmrqjjn
ZzdcbGTwLZwPPwpMPWpjWPpWChBC
nmznNRFHQrqQvqqmmMfWWWpMFjspWFMWjB
zqRDSmDrmvnvntGccGdcTVtLTlVG
nfnVscTcDzsZqmRtjtsqjJ
wnnhWPWLBNwPLHdQdWdHPHLdJjqRRqrvjrmqFtvRqtQRqFjm
bWhHdBBLdLnShWHcTVzCfCpVDTblpT
WSjVFSVTSWvgvFwpgTTFsfdVclhNCfsHnHlHsCfV
zRqLqZqZZQcdNltfHzsd
ZqBqGLLRcjWWBvTT
wwBqgZfbgbZsvWmfJrtFrdDttqdFdLct
SNSSVTnnThnCSPPnzVztQJJQdLPtFcGLdFGDsD
lSlszRVsRjmmfjfRRf
NGzGWSLzMdQtcctbgWjt
vqTnfVVHBffnCmHgMtrrrHrgtcrt
vqCDVlFnnCnnBSzlspSzLSNMLL
rwVlfVMRSTqTgRhT
pppjLtpZjHFHNhsctSqDDVtnns
HNjJLFBFHZZzWbVBZGfwdGrMfCCfGvmzlM
zFzztqWnJttqqzJtdqbtqbPVMGcGZwgPGVwGQjwCCggMZQ
hssLlrsSrBmBrZGSfgwgSwQCcj
BmBBDBHLrlNhLNHrpsDvLJNtddczdRzzcTqJzzdWnc
pLWcpGSscLQPDzLBgdbmdZHBHmZB
lntfCfVMvtttqVqnZHHbbBZmwwwCdHhc
qqRJFfRFRNlTzSSWWzSJpc
DrphDfFrdGGjTTgTgCSV
vbsMZPnPvqHMQvtZZPWBBVVBJjWSVTPjJC
nMbnsRSQvvLRMsssQhdFrcwczLlDrrDzhz
LLlDQlcLDqLSlCDRlRDCqTTzzgNzShSBdZGBFBBgNG
nHnMwPPbrWwpmztdMtzFZZFtTN
PJfbZmHrpJfZDRLlDlLcVsVJ
wZwQsrrzQFQSrRSFbzDglcdCcdljjdlljcvslLhv
VPqGJtqqfnJcCLFllFMGcd
fNHPJWpmHfffqJHmwzgbrBDZrDbFRQ
HggtSJtzrgltshlTsrzbzsgbFddfffDZwZRZZZGfGDRTNNZZ
LnjWccmQBPWqmWPqMfFNdGBRCDFFSfDfRd
WpMjWpMcWSjqqPjQLmvmjMgllsbgbtvsrrtvJgJHhrHl
PMcMcBpztMztzPPhbSgGSvgfHD
nsmsVQVZVQmTRmddrLgfFhfLgLDzgvffDhbF
dwsjrQQrVwTmZRTzsTdBcjqlqWpcCCppcllltC
DbVjbjwNMDTCVbhbTNDrVTTmzFGLFLHcLHzmcWFczLHwmH
PPWsfBZngtZqZZnPgZnPqvmFmczgRHGmGSRRSSLGFF
sntBlWPdnspnnPQZtnNNNMjhMNrVMjMThjpr
rCrCWVvvWDnBWvDnWDMCMZTpThhGGhGRGqGqZmhZqV
NNjQMzNzQjjwNmJNmZddpdTG
QwtwLPcjPtQlHSSslzwHSlPQDfDWsggsvvBvDvnvgngCnvFM
ZDCbvbDvvHbCGTWpZTtWWQnn
hLqzLVhVwNwVfMnJrfqMzWrQddgmQQGdgpgQGmgjTj
wlVNwJJfVRLPRnHRbFHRsP
lLmvLGRCrmDwVPVsjmtBBQmt
NSHWNbzSHWpSpfChqqJPnzBJsBPPJnQJ
pWcHbNfWpgZcWbhbZSgchWpRdCZMMdGDFFrLwlwMRRZFdd
PnNrFVZQHNDrmNQPflbhbfqbvhwbVfvq
TCdTtpCtCWTBMtjTJMWtBMCLSfvbqqzqbljflwDLvLjLLf
MCCGcpCJRWTTMGmPnDFNQQnDns
FhSmttZmgLjJVMlVGllGjcrj
NRNvNWNCdnNrBvWvwRdWvvvRCGcbVVQbMQGcGcVcMclzVVlG
qwBsBWwnvdtHJJSrtHsr
wnwPrnBBPgqRPjhgCRGCLvvbRZcJvCbb
dWVdVdlMHtsTslMtzztFGGczvvGJzL
fMflHpddJfNNVfNWWmDqQpwBgwnjPBQDjqBh
WttGctsNCNrfwTMlBtlr
HJLzLJJVnFjHbnbVjDHDdFqwwffTTfTGwrqwBBTT
jgVgJSbnHjNWsWCSWWGG
ssLfHLvrrfMMlBMRMfpd
qbbhmGCCVDQhQQVzDDbqmhMBtDZdBZHlddpltpBpdlJd
QhQbzqCGzVzSbqzLHjLgrcjvPSnnSL
NGGZGsGFCGvCcnCcgnZWrPHjsJjHjTDjJHfrjHDP
RzzQmwwmdRRwMqRQmZwtfrDPfTfrbjHqrDPTHr
MBLphmLpSzdRlnWZCNcGLgLG
LwPPHZLLWRMWMsHqTCjmTTjSTn
lFpNNpzplbfphzNcQzVcpvzsnqTsggmnjfgqCDsnCDqsgS
vFJJhQVhbcVddLtmWZJdmm
GwMNMGBMRMGjdSGsDntglDrDGQ
WTmPPzfmlQrsnQmg
ZPTJVvllhBwvLvwRwj
nlSvqqFqzfnbnvFwwsGHTBHgPfWsTrRPgG
dMdjphVhhgdLVJhNRBGPRWWBBGPTTGHV
thJgLpghLNLhNQMCtdMhSmFlQnzzwnbzlbqqSQFb
ZJJLBWhJBNwJwLvgRgGRgbZqbHTbGT
cCrfFFnzjmdrdrmmzsgSPSHSbHWPRgrgGR
dmCFntnFctjfdVtttjtDVncfBDlNJJppwQMwNBNvvplppWNh
GGNNNbNbqmsmTVbCDQQhDJQT
rgPvdgMdPdBddvMcrMnvgcSwhClTTJCwClDTvLJJthTlth
zBdWpnDBDmfFGRffzH
WNNNWcDcdVHNQTNT
lLvLctvrvvvPCpHLQQTZVQLTTHBV
zltgpbPCrrmtlmrlhhbqcWMqDDMDFMfbGScc
dzSHRCGZGdRQWQWtllWB
mNmbLbbmwjsmsNjDmcPvpVHBVPQvWDWBBpvB
jnmNNrLcnnjjHhSCdGMSfrfd
mgGvfvJSmSSrbvScmGccTPCqNnRjlpNNfNjqwqlpNpfw
zZLLQFFFtsFwWjjRqbbCsW
hBBLBdFHddVrGbVc
bJGchsCcHwbHfgvg
qdlSSNqLPqlPQZDffgfZRZMghvZr
PLtqtFTPNLlWlqtQqqQzBBmcnschGtjtnChmzC
llNLDLzjDtCTVtClCDMHSlmwdmmdSmddwZSS
gPJszvsBPbwSHZRQSJQJ
bgFssFPcWhDjCzLcnNDD
ZTGMwdhMwMJphZMJlNdVBCnncNPLBCCRPnCncn
fWsqmfSsqvfFFFvmWjfSSsPLCwVPRnPRCmRnRRCVzRCV
FQfQfvStwjtqsjvvQWFfWqWtlMDdGTJJGdMdhJtDMbllDZ
DzZLpBDptpVPrrrFPqRmBj
WsfCTTgMllCWJMlhslNsCFJrGqvmRPqmqZjGFjvmvm
HfghcNghHhgNNfbDDZdcdpndDzpt
RRBRdJfccVRdDJqdDrvwShwvztWJlWwSJn
mPtCHPPmHbmHNZjjjQHbMSgrSWhWzWnnQwvzzrlrll
tpFmjpmjFMCmppmVTVLFVfBqTqVDLd
jtljZcTcVVtdggVmdczzzDPzvCsvRbDsDmvm
MHHnnJMFMNpwSNprpMJrfsbPRRbWDGLbHLDRvzzssR
rJFNvQfBSwQBwNwldZTqTtctQchthc
WsWTWsfjgTJGSnTz
RHNmvRLCpJclcNcvHpNcPBzgQgMnnGFnLFgPgnPF
mHlcdbbccZcCCCNZZNcCWtthWbWqwwJsbDfthfwW
vFFzppnHFrjmpljQhg
JPGfPWVdwfPgQzVQlTrQrZ
PwRJfGDBfCHMzRHNHMNR";

fn priority_of_item(c: &u8) -> u32 {
    if c.is_ascii_lowercase() {
        (c - b'a' + 1) as u32
    } else {
        (c - b'A' + 27) as u32
    }
}

fn priority_of_line(line: &[u8]) -> u32 {
    let first_compartment = &line[..(line.len() / 2)];
    let second_compartment = &line[(line.len() / 2)..];
    let intersect = &first_compartment
        .iter()
        .map(|c| *c)
        .collect::<HashSet<u8>>()
        & &second_compartment
            .iter()
            .map(|c| *c)
            .collect::<HashSet<u8>>();
    intersect.iter().map(priority_of_item).sum::<u32>()
}

fn priority_of_group(group: &[&[u8]]) -> u32 {
    group
        .iter()
        .map(|line| line.iter().map(|c| *c).collect::<HashSet<u8>>())
        .fold(Option::None, |ot, l| {
            Option::Some(if let Option::Some(t) = ot { &t & &l } else { l })
        })
        .unwrap()
        .iter()
        .map(priority_of_item)
        .sum::<u32>()
}

fn main() {
    println!(
        "{}",
        INPUT
            .split(|c| *c == b'\n')
            .into_iter()
            .collect::<Vec<_>>()
            .as_slice()
            .chunks(3)
            .map(priority_of_group)
            .sum::<u32>()
    );
}
